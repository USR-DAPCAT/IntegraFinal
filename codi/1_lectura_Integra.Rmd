---
title: "Estudio INTEGRA: estrategia de INTervención intEgral en pacientes con mal control Glucémico de la diabetes mellitus tipo 2 en el Ámbito de Atención PRimariA"
author: "Rai Puig & Jordi Real"
website: "https://github.com/USR-DAPCAT/"

date: "`r format(Sys.time(), '%d %B, %Y')`"


output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
    fig_caption: true
    css: logos_css/usr_styles.css
  pdf_document: default
  word_document: default

params:
  dir_dades_origen: "../../DADES/INTEGRA" 
  dir_dades_desti: "dades"
---

&nbsp;
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"https://www.idiapjgol.org/images/logo.png\" style=\"float: right ;width: 130px;\"/>')
     $head.prepend('<img src=\"https://avatars2.githubusercontent.com/u/57066591?s=200&v=4\" style=\"margin-left:25% ;width: 80px;\"/>')
     $head.prepend('<img src=\"logoDAP_Cat.png\" style=\"float: left:1;width: 185px;\"/>')
   });
</script>

<div class="watermark">DRAFT</div>

****

# FASE LECTURA

>> Generació de taula plana i aplicació de primers criteris d'inclusió 


```{r setup, include = FALSE}

#rm(list=ls())


library("plyr")
library("dplyr")
library("purrr")
library("stringr")
library("tidyr")
library("compareGroups")
library("rmarkdown")
library("RODBC")
library("devtools")
library("pander")
library("hablar")




# Funcions 
link_source<-paste0("https://github.com/jrealgatius/Stat_codis/blob/master/funcions_propies.R","?raw=T")
devtools::source_url(link_source)

directori_dades<-params$dir_dades_origen

conductor<-here::here("Integra_Conductor.xls")

```
## 1. Lectura 
```{r lectura1}

#i)     DT_COSTOSSANITARIS
#ii)    DT_PACIENT_lab_06.06.2020
#iii)   DT_QUESTIONARI_BPAAT
#iv)    DT_QUESTIONARI_DTSQ
#v)     DT_QUESTIONARI_EQ5D
#vi)    DT_QUESTIONARI_PAM
#vii)   DT_VISITA_HISTORIC_PLANA_lab_06.02.2020
#viii)  LT_RESPOSTA_PAM

#----------------------------------------------------------------------#
#channel2<-odbcConnectAccess2007("dades/INTEGRABBDDJULIO01072019_22.07.2019.accdb")
#----------------------------------------------------------------------#

channel2<-odbcConnectAccess2007(here::here(directori_dades,"INTEGRABBDDJULIO01072019_22.07.2019.accdb"))
#channel3 <- odbcConnectAccess(here::here(directori_dades,"integra_20190502_bbdd_original.mdb"))

DT_COSTOSSANITARIS <- read_excel(here::here(directori_dades,"DT_COSTOSSANITARIS.xlsx"))
#[1] "visita_id"                    "consExternaCopsRelDiabetesNo" "consExternaCopsRelDiabetesSi" "costDerivacions"              "costIncapacitatsTemp"        
#[6] "costLaboratori"               "costMedicacio"                "costProfessionals"            "costProvesCompl"              "costTiresReactives"          
#[11] "costVisites"                  "formComplet"                  "ingresCopsRelDiabetesNo"      "ingresCopsRelDiabetesSi"      "numTiresReact1Any"           
#[16] "urgenciesCopsRelDiabetesNo"   "urgenciesCopsRelDiabetesSi"   "verificat"                    "consExterna_id"               "ingres_id"                   
#[21] "urgencies_id"      

DT_PACIENT_lab <- read_excel(here::here(directori_dades,"DT_PACIENT_lab_06.06.2020.xlsx"))
#[1] "...1"                                       "pacient_id"                                 "codiIdentificacioPacient"                   "codiPacient"                               
#[5] "estat"                                      "grupIntervencio"                            "usuari_id"                                  "centre_id"                                 
#[9] "codiUBA"                                    "abrevCentre"                                "codiCentre"                                 "nomCentre"                                 
#[13] "pacients"                                   "GR"                                         "dataCreacio"                                "dataConsentiment"                          
#[17] "motiuNoConsentiment"                        "inclusioConsentiment_id"                    "inclusioDxDM2_id"                           "inclusioEdat3080_id"                       
#[21] "inclusioHba1cGrau9minim_id"                 "inclusioSenseCanvisTt_id"                   "exclusioAltres_id"                          "exclusioDroguesAlcohol_id"                 
#[25] "exclusioEmabarasLactancia_id"               "exclusioFarmacsMetabHidrocarb_id"           "exclusioHemoglobinapatiesAnemia_id"         "exclusioIMCSuperior45_id"                  
#[29] "exclusioInsufCardiaca34NYHA_id"             "exclusioMalaltiaMentalDemencia_id"          "exclusioMalaltiaTerminal_id"                "exclusioParticipacioAssaigClinicFarmacs_id"
#[33] "exclusioTransplRenalDialisis_id"            "exclusioTtFarmacsAprimar_id"                "exclusioTtGlucocorticoides_id"              "exclusioTtImmunosupresors_id"              
#[37] "exclusioTtNeoplasiaMaligna_id"              "exclusioCanvisTt_id"                        "exclusioHba1cInferior9en3mesos_id"          "exclusioControlEndocrinoleg_id"            
#[41] "dataFiEstudi"                               "finalitzaEstudi_id"                         "motiuFinalEstudi_id


DT_QUESTIONARI_BPAAT <- read_excel(here::here(directori_dades,"DT_QUESTIONARI_BPAAT.xlsx"))
#[1] "visita_id"            "formComplet"          "totalBPAAT"           "verificat"            "activitatIntensa_id"  "activitatModerada_id"

DT_QUESTIONARI_DTSQ <- read_excel(here::here(directori_dades,"DT_QUESTIONARI_DTSQ.xlsx"))
#[1] "visita_id"                 "formComplet"               "pregFrequenciaSucreAlt"    "pregFrequenciaSucreBaix"   "pregRecomenacioTractament" "pregSatisfConeixMalaltia" 
#[7] "pregSatisfContTtActual"    "pregSatisfaccioTtActual"   "pregTractamentFlexible"    "pregTractamentPractic"     "totalDTSQ"                 "verificat"


DT_QUESTIONARI_EQ5D <- read_excel(here::here(directori_dades,"DT_QUESTIONARI_EQ5D.xlsx"))
#[1] "visita_id"                 "activitatPrincipalDescrip" "codiPostal"                "edat"                      "escalaAVSalut"             "formComplet"              
#[7] "treballSalutSocialDescrip" "verificat"                 "activitatPrincipal_id"     "estudisRealitzats_id"      "expMalGreuAltres_id"       "expMalGreuFamiliar_id"    
#[13] "expMalGreuPersonal_id"     "fumador_id"                "pregAnsietat_id"           "pregCuraPersonal_id"       "pregDolor_id"              "pregMovilitat_id"         
#[19] "pregQuotidianes_id"        "sexe_id"                   "treballSalutSocial_id"    


DT_QUESTIONARI_PAM <- read_excel(here::here(directori_dades,"DT_QUESTIONARI_PAM.xlsx"))
#[1] "visita_id"                   "formComplet"                 "totalPAM"                    "verificat"                   "pregAutoMedicacio_id"        "pregConeixMedicaments_id"   
#[7] "pregConeixTtsDisponibles_id" "pregEntenPSiCauses_id"       "pregEstilVidaEstres_id"      "pregEvitarPS_id"             "pregEvitarReduirPS_id"       "pregHabitsSaludables_id"    
#[13] "pregInformarMetge_id"        "pregPaperActiu_id"           "pregResponsable_id"          "pregSeguiTtCasa_id"          "pregSolucioNousPS_id"    


DT_VISITA_HISTORIC_PLANA_lab <- read_excel(here::here(directori_dades,"DT_VISITA_HISTORIC_PLANA_lab_06.02.2020.xlsx"))
#[1] "...1"                                      "tipus"                                     "visita_id"                                 "completa"                                 
#  [5] "dataVisita"                                "dataNaixement"                             "edat"                                      "sexe_id"                                  
#  [9] "etnia_id"                                  "altresEtniaDescrip"                        "problemesSalut_id"                         "clinicalRiskGroup"                        
#[13] "duracioDiabetesAnys"                       "duracioDiabetesMesos"                      "duracioDiabetesMesos2"                     "grupMorbiditatAjustada"                   
#[17] "dislipemia_id"                             "dataDxDislipemia"                          "hta_id"                                    "dataDxHta"                                
#[21] "altresProblemesSalut_id"                   "altresProblemesSalutDescrip"               "PATOLOGIATIROIDALBASAL_id_ALTRES"          "MPOCBASAL_id_ALTRES"                      
#[25] "MALALTIESMENTALSBASAL_id_ALTRES"           "CARDIOPATIAISQUEMICABASAL_id_ALTRES"       "RETINOPATIADIABETICABASAL_id_ALTRES"       "DISFUNCIOSEXUALBASAL_id_ALTRES"           
#[29] "NEOPLASIESBASAL_id_ALTRES"                 "PEUDIABETICBASAL_id_ALTRES"                "AMPUTACIONSBASAL_id_ALTRES"                "freqCardiaca"                             
#[33] "imc"                                       "perimetreCintura"                          "pes"                                       "talla"                                    
#[37] "tensioDiastolica"                          "tensioSistolica"                           "tensioBrac_id"                             "antiagregantsPlaquetaris_id"              
#[41] "anticoagulants_id"                         "antihipertensius_id"                       "hipolemiants_id"                           "altreMedicacioGral_id"                    
#[45] "altreMedicacioGral_id_ALTRES"              "antiagregantsPlaquetaris_id_ALTRES"        "anticoagulants_id_ALTRES"                  "antihipertensius_id_ALTRES"               
#[49] "hipolemiants_id_ALTRES"                    "ANTIDEPRESSANTS_id_ALTRES"                 "ANTIPSYCHOTICS_id_ALTRES"                  "ANTIEPILEPTICS_id_ALTRES"                 
#[53] "ANXIOLYTICS_id_ALTRES"                     "OPIOIDS_id_ALTRES"                         "CORTICOSTEROIDS_id_ALTRES"                 "OTHERANALGESICSANDANTIPYRETICS_id_ALTRES" 
#[57] "NSAID_ALTRES"                              "ADRENERGICS_INHALANTS_id_ALTRES"           "THYROIDPREPARATIONS_id_ALTRES"             "HORMONES_id_ALTRES"                       
#[61] "adoAcarbosa_id"                            "adoCanagliflozina_id"                      "adoClorpopramida_id"                       "adoCombiGlimepiridaPioglitazona_id"       
#[65] "adoCombiMetforminaPioglitazona_id"         "adoCombiMetforminaSaxaglitina_id"          "adoCombiMetforminaSitagliptina_id"         "adoCombiMetforminaVildagliptina_id"       
#[69] "adoDapagliflozina_id"                      "adoEmpagliflozina_id"                      "adoGlibenclamida_id"                       "adoGlibornurida_id"                       
#[73] "adoGliclazida_id"                          "adoGlimepirida_id"                         "adoGlipizida_id"                           "adoGliquidona_id"                         
#[77] "adoLinagliptina_id"                        "adoMetformina_id"                          "adoMiglitol_id"                            "adoNateglinida_id"                        
#[81] "adoPioglitazona_id"                        "adoRepaglinida_id"                         "adoSaxagliptina_id"                        "adoSitagliptina_id"                       
#[85] "adoTolbutamida_id"                         "adoVildagliptina_id"                       "altreMedicacioADO_id"                      "adoCombiMetforminaLinaglibtina_id_ALTRES" 
#[89] "adoCombiMetforminaAlogliptina_id_ALTRES"   "adoAlogliptina_id_ALTRES"                  "adoCombiAlogliptinaPioglitazona_id_ALTRES" "adoCombMetforminaEmpaglifozina_id_ALTRES" 
#[93] "adoCombMetforminaDapaglifozina_id_ALTRES"  "injAbasaglar_id"                           "injAbiglutida_id"                          "injActrapid_id"                           
#[97] "injApidra_id"                              "injExenatida_id"                           "injHumalog_id"                             "injHumalogBasal_id"                       
#[101] "injHumalogMix25_id"                        "injHumalogMix50_id"                        "injHumilana3070_id"                        "injHumulinaNPH_id"                        
#[105] "injHumulinaRegular_id"                     "injInsulatard_id"                          "injLantus_id"                              "injLevemir_id"                            
#[109] "injLiraglutida_id"                         "injLixisenatide_id"                        "injMixtard30_id"                           "injNovomix30_id"                          
#[113] "injNovomix50_id"                           "injNovomix70_id"                           "injNovorapid_id"                           "altreMedicacioInjInsulina_id"             
#[117] "injToujeo_id_ALTRES"                       "injTresiba_id_ALTRES"                      "injExenatida_id_ALTRES"                    "injAbasaglar_id_ALTRES"                   
#[121] "dataAnalitica"                             "glucosa"                                   "hba1cIFCC"                                 "hba1cNGSP"                                
#[125] "alt"                                       "ast"                                       "ggt"                                       "colesterolHdl"                            
#[129] "colesterolLdl"                             "colesterolNoHdl"                           "colesterolTtl"                             "triglicerids"                             
#[133] "volumCorpuscularMig"                       "hematocrit"                                "hemoglobina"                               "hemoglobinaCorpuscularMitja"              
#[137] "ide"                                       "hematies"                                  "leucocits"                                 "plaquetes"                                
#[141] "linfocits"                                 "monocits"                                  "neutrofils"                                "eosinofils"                               
#[145] "basofils"                                  "creatinina"                                "filtratGlomerular"                         "filtratGlomerularSuperior60"              
#[149] "orinaCreatinina"                           "orinaMicroalbuminuria"                     "orinaMicroalbuminuriaCreatinina"           "cigarretsDia"                             
#[153] "dataFiTabac"                               "dataIniciTabac"                            "fumador_id"                                "motiuNoSeguiment"                         
#[157] "seguimentRecomenacions_id"                 "arteriopatiaPeriferica_id"                 "cardiopatiaIsquemica_id"                   "insuficienciaCardiaca_id"                 
#[161] "malaltiaCerebrovascular_id"                "nefropatiaDiabetica_id"                    "neuropatiaDiabetica_id"                    "retinopatiaDiabetica_id"                  
#[165] "altresComplicacions_id"                    "PATOLOGIATIROIDAL_id_ALTRES"               "MPOC_id_ALTRES"                            "MALALTIESMENTALS_id_ALTRES"               
#[169] "DISFUNCIOSEXUAL_id_ALTRES"                 "NEOPLASIES_id_ALTRES"                      "PEUDIABETIC_id_ALTRES"                     "AMPUTACIONS_id_ALTRES"                    
#[173] "ingresCopsRelDiabetesNo"                   "ingresCopsRelDiabetesSi"                   "urgenciesCopsRelDiabetesNo"                "urgenciesCopsRelDiabetesSi"               
#[177] "ingres_id"                                 "urgencies_id"                              "consExterna_id"                            "consExternaCopsRelDiabetesNo"             
#[181] "consExternaCopsRelDiabetesSi"              "numTiresReact1Any"                         "costDerivacions"                           "costIncapacitatsTemp"                     
#[185] "costLaboratori"                            "costMedicacio"                             "costProfessionals"                         "costProvesCompl"                          
#[189] "costTiresReactives"                        "costVisites"            

#LT_RESPOSTA_PAM <- read_excel(here::here(directori_dades,"LT_RESPOSTA_PAM.xlsx"))



DT_VISITA<- sqlQuery( channel2, paste ("select * from DT_VISITA "))
DT_VISITA<-DT_VISITA%>%mutate(pacient_id=pacient_pacient_id)%>%dplyr::select(tipus,pacient_id,visita_id,completa,dataVisita)
DT_VISITA<-DT_VISITA%>%select(pacient_id,visita_id)
#[1] "Id"                 "tipus"              "visita_id"          "completa"           "dataVisita"         "pacient_pacient_id" "pacient_id" 



#01]
#altreMedicacioADO <- sqlQuery( channel2, paste ("select * from altreMedicacioADO"))

#names(altreMedicacioADO)
# 1.1 altreMedicacioADO 
#[1] "Id"                                   "visita_id"                            "altreMedicacioADODescrip"            
#[4] "adoCombiMetforminaLinaglibtina_id"    "adoCombiMetforminaLinaglibtinadosis"  "adoCombiMetforminaAlogliptina_id"    
#[7] "adoCombiMetforminaAlogliptinadosis"   "adoAlogliptina_id"                    "adoAlogliptina_dosis"                
#[10] "adoCombiAlogliptinaPioglitazona_id"   "adoCombiAlogliptinaPioglitazonadosis" "adoCombMetforminaEmpaglifozina_id"   
#[13] "adoCombMetforminaEmpaglifozinadosis"  "adoCombMetforminaDapaglifozina_id"    "adoCombMetforminaDapaglifozinaDosis" 


#02]****
#altreMedicacioGr <- sqlQuery( channel2, paste ("select * from altreMedicacioGr"))

#names(altreMedicacioGr)
#1] "Id"                                   "visita_id"                            "altreMedicacioGralDescripORIGIGINAL" 
#[4] "altreMedicacioPrincipioactivoDescrip" "ATC/DDD"                              "pharmacological subgroup"            
#[7] "altreMedicacioGral_id"                "antiagregantsPlaquetaris_id"          "anticoagulants_id"                   
#[10] "antihipertensius_id"                  "hipolemiants_id"                      "ANTIDEPRESSANTS_id"                  
#[13] "ANTIPSYCHOTICS_id"                    "ANTIEPILEPTICS_id"                    "ANXIOLYTICS_id"                      
#[16] "OPIOIDS_id"                           "CORTICOSTEROIDS_id"                   "OTHER ANALGESICS AND ANTIPYRETICS_id"
#[19] "NSAID"                                "ADRENERGICS, INHALANTS_id"            "THYROID PREPARATIONS_id"             
#[22] "HORMONES_id"            #1.2 altreMedicacioGr


#03]
#altreMedicacioInj <- sqlQuery( channel2, paste ("select * from altreMedicacioInj "))

#names(altreMedicacioInj )
#altreMedicacioInj 
#[1] "Id"                                              "visita_id"                                      
#[3] "altreMedicacioInjInsulinaPrincipioactivoDescrip" "injToujeo_id"                                   
#[5] "injToujeoDosi"                                   "injTresiba_id"                                  
#[7] "injTresibaDosi"                                  "injExenatida_id"                                
#[9] "injExenatidaDosi"                                "injAbasaglar_id"                                
#[11]"injAbasaglarDosi"                                "injAbasaglarDosi"        


#04] 
#altresComplicacions <- sqlQuery( channel2, paste ("select * from altresComplicacionsDescrip "))

#names(altresComplicacions)
#[1] "Id"                         "visita_id"                  "altresComplicacionsDescrip" "CIE10"                     
#[5] "Teritorio"                  "PATOLOGIA TIROIDAL_id"      "MPOC_id"                    "MALALTIES MENTALS_id"      
#[9] "DISFUNCI? SEXUAL_id"        "NEOPLASIES_id"              "PEU DIAB?TIC_id"            "AMPUTACIONS_id"     


#05] 
#altresProblemesSalut<- sqlQuery( channel2, paste ("select * from altresProblemesSalut"))

#names(altresProblemesSalut)
#[1] "Id"                             "visita_id"                      "altresProblemesSalutDescrip"    "c?digo CIE 10"                 
#[5] "Teritorio"                      "PATOLOGIA TIROIDAL BASAL_id"    "MPOC BASAL_id"                  "MALALTIES MENTALS BASAL_id"    
#[9] "CARDIOPATIA ISQU?MICA BASAL_id" "RETINOPATIA DIAB?TICA BASAL_id" "DISFUNCI? SEXUAL BASAL_id"      "NEOPLASIES BASAL_id"           
#[13] "PEU DIAB?TIC BASAL_id"          "AMPUTACIONS BASAL_id" 


#06]
#DT_ANALITICA<- sqlQuery( channel2, paste ("select * from DT_ANALITICA"))

#names(DT_ANALITICA)
#[1] "Id"                              "visita_id"                       "alt"                             "ast"                            
#[5] "basofils"                        "colesterolHdl"                   "colesterolLdl"                   "colesterolNoHdl"                
#[9] "colesterolTtl"                   "concHGBCorspuscularMitja"        "creatinina"                      "dataAnalitica"                  
#[13] "eosinofils"                      "filtratGlomerular"               "formComplet"                     "ggt"                            
#[17] "glucosa"                         "hba1cIFCC"                       "hba1cNGSP"                       "hematies"                       
#[21] "hematocrit"                      "hemoglobina"                     "hemoglobinaCorpuscularMitja"     "ide"                            
#[25] "leucocits"                       "linfocits"                       "monocits"                        "neutrofils"                     
#[29] "orinaCreatinina"                 "orinaMicroalbuminuria"           "orinaMicroalbuminuriaCreatinina" "plaquetes"                      
#[33] "triglicerids"                    "verificat"                       "volumCorpuscularMig"             "filtratGlomerularSuperior60"    
 

#07]
#DT_COMPLICACIONS<- sqlQuery( channel2, paste ("select * from DT_COMPLICACIONS"))

#names(DT_COMPLICACIONS)
#[1] "Id"                            "visita_id"                     "altresComplicacionsDescrip"    "dataDxArteriopatiaPeriferica" 
#[5] "dataDxCardiopatiaIsquemica"    "dataDxInsuficienciaCardiaca"   "dataDxMalaltiaCerebrovascular" "dataDxNefropatiaDiabetica"    
#[9] "dataDxNeuropatiaDiabetica"     "dataDxRetinopatiaDiabetica"    "formComplet"                   "numHipoglucemiesGreus"        
#[13] "verificat"                     "altresComplicacions_id"        "arteriopatiaPeriferica_id"     "cardiopatiaIsquemica_id"      
#[17] "insuficienciaCardiaca_id"      "malaltiaCerebrovascular_id"    "nefropatiaDiabetica_id"        "neuropatiaDiabetica_id"       
#[21] "retinopatiaDiabetica_id"     


#08]
#DT_CRITERIS<- sqlQuery( channel2, paste ("select * from DT_CRITERIS "))

#names(DT_CRITERIS)
#[1] "Id"                                         "pacient_id"                                 "codiIdentificacioPacient"                  
#[4] "codiUBA"                                    "dataConsentiment"                           "formComplet"                               
#[7] "motiuNoConsentiment"                        "exclusioAltres_id"                          "exclusioDroguesAlcohol_id"                 
#[10] "exclusioEmabarasLactancia_id"               "exclusioFarmacsMetabHidrocarb_id"           "exclusioHemoglobinapatiesAnemia_id"        
#[13] "exclusioIMCSuperior45_id"                   "exclusioInsufCardiaca34NYHA_id"             "exclusioMalaltiaMentalDemencia_id"         
#[16] "exclusioMalaltiaTerminal_id"                "exclusioParticipacioAssaigClinicFarmacs_id" "exclusioTransplRenalDialisis_id"           
#[19] "exclusioTtFarmacsAprimar_id"                "exclusioTtGlucocorticoides_id"              "exclusioTtImmunosupresors_id"              
#[22] "exclusioTtNeoplasiaMaligna_id"              "inclusioConsentiment_id"                    "inclusioDxDM2_id"                          
#[25] "inclusioEdat3080_id"                        "inclusioHba1cGrau9minim_id"                 "inclusioSenseCanvisTt_id"                  
#[28] "exclusioCanvisTt_id"                        "exclusioHba1cInferior9en3mesos_id"          "exclusioControlEndocrinoleg_id"                           "exclusioHba1cInferior9en3mesos_id"          "exclusioControlEndocrinoleg_id"            


#DT_DEMOGRAFIA
#09]
#DT_DEMOGRAFIA<- sqlQuery( channel2, paste ("select * from DT_DEMOGRAFIA "))
#DT_DEMOGRAFIA2 <- sqlFetch( channel3, 'DT_DEMOGRAFIA')

#names(DT_DEMOGRAFIA)
#[1] "Id"                 "visita_id"          "dataNaixement"      "edat"               "formComplet"        "verificat"         
#[7] "sexe_id"            "codiSeguiment"      "etnia_id"           "altresEtniaDescrip"
 

#DT_EXPLORACIOFISICA
#10]
#DT_EXPLORACIOFISICA<- sqlQuery( channel2, paste ("select * from DT_EXPLORACIOFISICA "))

#names(DT_EXPLORACIOFISICA)
#[1] "Id"               "visita_id"        "formComplet"      "freqCardiaca"     "imc"              "perimetreCintura" "pes"             
#[8] "talla"            "tensioDiastolica" "tensioSistolica"  "verificat"        "tensioBrac_id"   


#DT_FINALITZACIO
#11]
#DT_FINALITZACIO<- sqlQuery( channel2, paste ("select * from DT_FINALITZACIO "))

#names(DT_FINALITZACIO)
#[1] "Id"                            "pacient_id"                    "altresMotiusDescrip_Unificado" "dataFiEstudi"                 
#[5] "formComplet"                   "verificat"                     "finalitzaEstudi_id"            "motiuFinalEstudi_id" 


#DT_HABITS_TOXICS
#12]
#DT_HABITS_TOXICS<- sqlQuery( channel2, paste ("select * from DT_HABITS_TOXICS "))

#names(DT_HABITS_TOXICS)
#[1] "Id"             "visita_id"      "cigarretsDia"   "dataFiTabac"    "dataIniciTabac" "formComplet"    "verificat"      "fumador_id" 


#DT_HISTORIAMEDICA
#13]
#DT_HISTORIAMEDICA<- sqlQuery( channel2, paste ("select * from DT_HISTORIAMEDICA "))

#names(DT_HISTORIAMEDICA)
#[1] "Id"                          "visita_id"                   "altresProblemesSalutDescrip" "clinicalRiskGroup"          
#[5] "dataDxDislipemia"            "dataDxHta"                   "duracioDiabetesAnys"         "duracioDiabetesMesos"       
#[9] "formComplet"                 "grupMorbiditatAjustada"      "verificat"                   "altresProblemesSalut_id"    
#[13] "dislipemia_id"               "hta_id"                      "problemesSalut_id"            


#DT_MEDICACIO_ADO
#14]
#DT_MEDICACIO_ADO<- sqlQuery( channel2, paste ("select * from DT_MEDICACIO_ADO"))

#names(DT_MEDICACIO_ADO)
#[1] "Id"                                  "visita_id"                           "adoAcarbosaDosi"                    
#[4] "adoCanagliflozinaDosi"               "adoClorpopramidaDosi"                "adoCombiGlimepiridaPioglitazonaDosi"
#[7] "adoCombiMetforminaPioglitazonaDosi"  "adoCombiMetforminaSaxaglitinaDosi"   "adoCombiMetforminaSitagliptinaDosi" 
#[10] "adoCombiMetforminaVildagliptinaDosi" "adoDapagliflozinaDosi"               "adoEmpagliflozinaDosi"              
#[13] "adoGlibenclamidaDosi"                "adoGlibornuridaDosi"                 "adoGliclazidaDosi"                  
#[16] "adoGlimepiridaDosi"                  "adoGlipizidaDosi"                    "adoGliquidonaDosi"                  
#[19] "adoLinagliptinaDosi"                 "adoMetforminaDosi"                   "adoMiglitolDosi"                    
#[22] "adoNateglinidaDosi"                  "adoPioglitazonaDosi"                 "adoRepaglinidaDosi"                 
#[25] "adoSaxagliptinaDosi"                 "adoSitagliptinaDosi"                 "adoTolbutamidaDosi"                 
#[28] "adoVildagliptinaDosi"                "altreMedicacioADODescrip"            "formComplet"                        
#[31] "verificat"                           "adoAcarbosa_id"                      "adoCanagliflozina_id"               
#[34] "adoClorpopramida_id"                 "adoCombiGlimepiridaPioglitazona_id"  "adoCombiMetforminaPioglitazona_id"  
#[37] "adoCombiMetforminaSaxaglitina_id"    "adoCombiMetforminaSitagliptina_id"   "adoCombiMetforminaVildagliptina_id" 
#[40] "adoDapagliflozina_id"                "adoEmpagliflozina_id"                "adoGlibenclamida_id"                
#[43] "adoGlibornurida_id"                  "adoGliclazida_id"                    "adoGlimepirida_id"                  
#[46] "adoGlipizida_id"                     "adoGliquidona_id"                    "adoLinagliptina_id"                 
#[49] "adoMetformina_id"                    "adoMiglitol_id"                      "adoNateglinida_id"                  
#[52] "adoPioglitazona_id"                  "adoRepaglinida_id"                   "adoSaxagliptina_id"                 
#[55] "adoSitagliptina_id"                  "adoTolbutamida_id"                   "adoVildagliptina_id"                
#[58] "altreMedicacioADO_id"       


#DT_MEDICACIO_GENERAL
#15]
#DT_MEDICACIO_GENERAL<- sqlQuery( channel2, paste ("select * from DT_MEDICACIO_GENERAL"))

#names(DT_MEDICACIO_GENERAL)
#[1] "Id"                          "visita_id"                   "altreMedicacioGralDescrip"   "formComplet"                
#[5] "verificat"                   "altreMedicacioGral_id"       "antiagregantsPlaquetaris_id" "anticoagulants_id"          
#[9] "antihipertensius_id"         "hipolemiants_id"    


#DT_MEDICACIO_INJECTABLES
#16]
#DT_MEDICACIO_INJECTABLES<- sqlQuery( channel2, paste ("select * from DT_MEDICACIO_INJECTABLES"))

#names(DT_MEDICACIO_INJECTABLES)
#[1] "Id"                               "visita_id"                        "altreMedicacioInjInsulinaDescrip" "formComplet"                     
#[5] "injAbasaglarDosi"                 "injAbiglutidaDosi"                "injActrapidDosi"                  "injApidraDosi"                   
#[9] "injExenatidaDosi"                 "injHumalogBasalDosi"              "injHumalogDosi"                   "injHumalogMix25Dosi"             
#[13] "injHumalogMix50Dosi"              "injHumilana3070Dosi"              "injHumulinaNPHDosi"               "injHumulinaRegularDosi"          
#[17] "injInsulatardDosi"                "injLantusDosi"                    "injLevemirDosi"                   "injLiraglutidaDosi"              
#[21] "injLixisenatideDosi"              "injMixtard30Dosi"                 "injNovomix30Dosi"                 "injNovomix50Dosi"                
#[25] "injNovomix70Dosi"                 "injNovorapidDosi"                 "verificat"                        "altreMedicacioInjInsulina_id"    
#[29] "injAbasaglar_id"                  "injAbiglutida_id"                 "injActrapid_id"                   "injApidra_id"                    
#[33] "injExenatida_id"                  "injHumalog_id"                    "injHumalogBasal_id"               "injHumalogMix25_id"              
#[37] "injHumalogMix50_id"               "injHumilana3070_id"               "injHumulinaNPH_id"                "injHumulinaRegular_id"           
#[41] "injInsulatard_id"                 "injLantus_id"                     "injLevemir_id"                    "injLiraglutida_id"               
#[45] "injLixisenatide_id"               "injMixtard30_id"                  "injNovomix30_id"                  "injNovomix50_id"                 
#[49] "injNovomix70_id"                  "injNovorapid_id"   


###################################
#[  DT_PACIENT_DISCONTINUADOS     ]
#[  DT_PACIENT_EXCLUIDOS          ]
#[  DT_PACIENT_FALLO_DE_SCREENING ]
#[  DT_PACIENT_INCLUIDOS          ]
###################################


#DT_CRITERIS<-DT_CRITERIS%>%dplyr::select(-Id,-formComplet,-codiUBA,-codiIdentificacioPacient)
#DT_FINALITZACIO<-DT_FINALITZACIO%>%dplyr::select(-Id,-formComplet,-verificat)



#DT_PACIENT_DISCONTINUADOS
#17]
#DT_PACIENT_DISCONTINUADOS<- sqlQuery( channel2, paste ("select * from DT_PACIENT_DISCONTINUADOS"))

#names(DT_PACIENT_DISCONTINUADOS)
#[1] "Id"                       "pacient_id"               "codiIdentificacioPacient" "codiPacient"              "codiUBA"                 
#[6] "dataCreacio"              "estat"                    "grupIntervencio"          "usuari_id"                "centre_id" 
#--------
#DT_PACIENT_DISCONTINUADOS<-DT_PACIENT_DISCONTINUADOS%>%left_join(DT_CRITERIS   ,by="pacient_id")
#DT_PACIENT_DISCONTINUADOS<-DT_PACIENT_DISCONTINUADOS%>%left_join(DT_FINALITZACIO   ,by="pacient_id")%>%dplyr::select(-altresMotiusDescrip_Unificado)
#DT_PACIENT_DISCONTINUADOS<-DT_PACIENT_DISCONTINUADOS%>%mutate(GR="DISC")



#DT_PACIENT_EXCLUIDOS
#18]
#DT_PACIENT_EXCLUIDOS<- sqlQuery( channel2, paste ("select * from DT_PACIENT_EXCLUIDOS"))

#names(DT_PACIENT_EXCLUIDOS)
#[1] "Id"                       "pacient_id"               "codiIdentificacioPacient" "codiPacient"              "codiUBA"                 
#[6] "dataCreacio"              "estat"                    "grupIntervencio"          "usuari_id"                "centre_id"     

#---------
#DT_PACIENT_EXCLUIDOS<-DT_PACIENT_EXCLUIDOS%>%left_join(DT_CRITERIS   ,by="pacient_id")
#DT_PACIENT_EXCLUIDOS<-DT_PACIENT_EXCLUIDOS%>%left_join(DT_FINALITZACIO   ,by="pacient_id")%>%dplyr::select(-altresMotiusDescrip_Unificado)
#DT_PACIENT_EXCLUIDOS<-DT_PACIENT_EXCLUIDOS%>%mutate(GR="EXCL")

#DT_PACIENT_FALLO DE SCREENING
#19]
#DT_PACIENT_FALLO_DE_SCREENING<- sqlQuery( channel2, paste ("select * from DT_PACIENT_FALLO_DE_SCREENING"))

#names(DT_PACIENT_FALLO_DE_SCREENING)
#[1] "Id"                       "pacient_id"               "codiIdentificacioPacient" "codiPacient"              "codiUBA"                 
#[6] "dataCreacio"              "estat"                    "grupIntervencio"          "usuari_id"                "centre_id"       

#---------
#DT_PACIENT_FALLO_DE_SCREENING<-DT_PACIENT_FALLO_DE_SCREENING%>%left_join(DT_CRITERIS   ,by="pacient_id")
#DT_PACIENT_FALLO_DE_SCREENING<-DT_PACIENT_FALLO_DE_SCREENING%>%left_join(DT_FINALITZACIO   ,by="pacient_id")%>%dplyr::select(-altresMotiusDescrip_Unificado)
#DT_PACIENT_FALLO_DE_SCREENING<-DT_PACIENT_FALLO_DE_SCREENING%>%mutate(GR="FALL_SCREEN")

#DT_PACIENT_INCLUIDOS
#20]
#DT_PACIENT_INCLUIDOS<- sqlQuery( channel2, paste ("select * from DT_PACIENT_INCLUIDOS"))

#names(DT_PACIENT_INCLUIDOS)
#[1] "Id"                       "pacient_id"               "codiIdentificacioPacient" "codiPacient"              "codiUBA"                 
#[6] "dataCreacio"              "estat"                    "grupIntervencio"          "usuari_id"                "centre_id"  

#---------
#DT_PACIENT_INCLUIDOS<-DT_PACIENT_INCLUIDOS%>%left_join(DT_CRITERIS   ,by="pacient_id")
#DT_PACIENT_INCLUIDOS<-DT_PACIENT_INCLUIDOS%>%left_join(DT_FINALITZACIO   ,by="pacient_id")%>%dplyr::select(-altresMotiusDescrip_Unificado)
#DT_PACIENT_INCLUIDOS<-DT_PACIENT_INCLUIDOS%>%mutate(GR="INCL")
#---------



#DT_SEGUIMENT
#21]
#DT_SEGUIMENT<- sqlQuery( channel2, paste ("select * from DT_SEGUIMENT"))

#names(DT_SEGUIMENT)
#[1] "Id"                        "visita_id"                 "formComplet"               "motiuNoSeguiment"          "verificat"                
#[6] "seguimentRecomenacions_id"


#DT_VISITA
#22]
#DT_VISITA<- sqlQuery( channel2, paste ("select * from DT_VISITA "))
#DT_VISITA<-DT_VISITA%>%mutate(pacient_id=pacient_pacient_id)%>%dplyr::select(tipus,pacient_id,visita_id,completa,dataVisita)

#names(DT_VISITA)
#[1] "Id"                 "tipus"              "visita_id"          "completa"           "dataVisita"         "pacient_pacient_id"




#DT_COSTOSSANITARIS<-sqlQuery( channel2, paste ("select * from DT_COSTOSSANITARIS"))

#names(DT_COSTOSSANITARIS)
#[1] "Id"                           "visita_id"                    "consExternaCopsRelDiabetesNo" "consExternaCopsRelDiabetesSi"
#[5] "costDerivacions"              "costIncapacitatsTemp"         "costLaboratori"               "costMedicacio"               
#[9] "costProfessionals"            "costProvesCompl"              "costTiresReactives"           "costVisites"                 
#[13] "formComplet"                  "ingresCopsRelDiabetesNo"      "ingresCopsRelDiabetesSi"      "numTiresReact1Any"           
#[17] "urgenciesCopsRelDiabetesNo"   "urgenciesCopsRelDiabetesSi"   "verificat"                    "consExterna_id"              
#[21] "ingres_id"                    "urgencies_id"                


#DT_CENTRE
#24] Ok
#DT_CENTRE<-sqlQuery( channel2, paste ("select * from DT_CENTRE"))

#names(DT_CENTRE)
#[1] "Id"              "centre_id"       "abrevCentre"     "codiCentre"      "grupIntervencio"
#[6] "nomCentre"       "pacients"       





#names(DT_CRITERIS)
#names(DT_FINALITZACIO)



#prova<-DT_VISITA_HISTORIC_PLANA_lab%>%
#  arrange(visita_id)%>%
#  group_by(visita_id)%>% slice(1) %>% ungroup() %>%dplyr::select(visita_id,sexe_id,tipus)%>%
#    left_join(DT_VISITA   ,by="visita_id")%>%filter(tipus=="Mes00")%>%
#     left_join(DT_QUESTIONARI_EQ5D   ,by="visita_id")%>%select(visita_id,pacient_id,sexe_id.x,sexe_id.y)
     

#ok!!!

```

## 1. Lectura (part2.Filtre) 
```{r lectura2}

#variable.names(DT_COSTOSSANITARIS )
#[1] "visita_id"                    "consExternaCopsRelDiabetesNo" "consExternaCopsRelDiabetesSi" "costDerivacions"             
#[5] "costIncapacitatsTemp"         "costLaboratori"               "costMedicacio"                "costProfessionals"           
#[9] "costProvesCompl"              "costTiresReactives"           "costVisites"                  "formComplet"                 
#[13] "ingresCopsRelDiabetesNo"      "ingresCopsRelDiabetesSi"      "numTiresReact1Any"            "urgenciesCopsRelDiabetesNo"  
#[17] "urgenciesCopsRelDiabetesSi"   "verificat"                    "consExterna_id"               "ingres_id"                   
#[21] "urgencies_id"         
#variable.names(DT_PACIENT_lab )
# [1] "...1"                                       "pacient_id"                                
# [3] "codiIdentificacioPacient"                   "codiPacient"                               #
# [5] "estat"                                      "grupIntervencio"                           
# [7] "usuari_id"                                  "centre_id"                                 
# [9] "codiUBA"                                    "abrevCentre"                               
#[11] "codiCentre"                                 "nomCentre"                                 
#[13] "pacients"                                   "GR"                                        
#[15] "dataCreacio"                                "dataConsentiment"                          
#[17] "motiuNoConsentiment"                        "inclusioConsentiment_id"                   
#[19] "inclusioDxDM2_id"                           "inclusioEdat3080_id"                       
#[21] "inclusioHba1cGrau9minim_id"                 "inclusioSenseCanvisTt_id"                  
#[23] "exclusioAltres_id"                          "exclusioDroguesAlcohol_id"                 
#[25] "exclusioEmabarasLactancia_id"               "exclusioFarmacsMetabHidrocarb_id"          
#[27] "exclusioHemoglobinapatiesAnemia_id"         "exclusioIMCSuperior45_id"                  
#[29] "exclusioInsufCardiaca34NYHA_id"             "exclusioMalaltiaMentalDemencia_id"         
#[31] "exclusioMalaltiaTerminal_id"                "exclusioParticipacioAssaigClinicFarmacs_id"
#[33] "exclusioTransplRenalDialisis_id"            "exclusioTtFarmacsAprimar_id"               
#[35] "exclusioTtGlucocorticoides_id"              "exclusioTtImmunosupresors_id"              
#[37] "exclusioTtNeoplasiaMaligna_id"              "exclusioCanvisTt_id"                       
#[39] "exclusioHba1cInferior9en3mesos_id"          "exclusioControlEndocrinoleg_id"            
#[41] "dataFiEstudi"                               "finalitzaEstudi_id"                        
#[43] "motiuFinalEstudi_id"
#variable.names(DT_QUESTIONARI_BPAAT )
#[1] "visita_id"            "formComplet"          "totalBPAAT"           "verificat"            "activitatIntensa_id" 
#[6] "activitatModerada_id"
#variable.names(DT_QUESTIONARI_DTSQ )
#[1] "visita_id"                 "formComplet"               "pregFrequenciaSucreAlt"    "pregFrequenciaSucreBaix"  
# [5] "pregRecomenacioTractament" "pregSatisfConeixMalaltia"  "pregSatisfContTtActual"    "pregSatisfaccioTtActual"  
# [9] "pregTractamentFlexible"    "pregTractamentPractic"     "totalDTSQ"                 "verificat"   
#variable.names(DT_QUESTIONARI_EQ5D )
#[1] "visita_id"                 "activitatPrincipalDescrip" "codiPostal"                "edat"                     
# [5] "escalaAVSalut"             "formComplet"               "treballSalutSocialDescrip" "verificat"                
# [9] "activitatPrincipal_id"     "estudisRealitzats_id"      "expMalGreuAltres_id"       "expMalGreuFamiliar_id"    
#[13] "expMalGreuPersonal_id"     "fumador_id"                "pregAnsietat_id"           "pregCuraPersonal_id"      
#[17] "pregDolor_id"              "pregMovilitat_id"          "pregQuotidianes_id"        "sexe_id"                  
#[21] "treballSalutSocial_id"    
#variable.names(DT_QUESTIONARI_PAM )
#[1] "visita_id"                   "formComplet"                 "totalPAM"                    "verificat"                  
# [5] "pregAutoMedicacio_id"        "pregConeixMedicaments_id"    "pregConeixTtsDisponibles_id" "pregEntenPSiCauses_id"      
# [9] "pregEstilVidaEstres_id"      "pregEvitarPS_id"             "pregEvitarReduirPS_id"       "pregHabitsSaludables_id"    
#[13] "pregInformarMetge_id"        "pregPaperActiu_id"           "pregResponsable_id"          "pregSeguiTtCasa_id"         
#[17] "pregSolucioNousPS_id"       
#variable.names(DT_VISITA_HISTORIC_PLANA_lab)
#  [1] "...1"                                      "tipus"                                    
#  [3] "visita_id"                                 "completa"                                 
#  [5] "dataVisita"                                "dataNaixement"                            
#  [7] "edat"                                      "sexe_id"                                  
#  [9] "etnia_id"                                  "altresEtniaDescrip"                       
# [11] "problemesSalut_id"                         "clinicalRiskGroup"                        
# [13] "duracioDiabetesAnys"                       "duracioDiabetesMesos"                     
# [15] "duracioDiabetesMesos2"                     "grupMorbiditatAjustada"                   
# [17] "dislipemia_id"                             "dataDxDislipemia"                         
# [19] "hta_id"                                    "dataDxHta"                                
# [21] "altresProblemesSalut_id"                   "altresProblemesSalutDescrip"              
# [23] "PATOLOGIATIROIDALBASAL_id_ALTRES"          "MPOCBASAL_id_ALTRES"                      
# [25] "MALALTIESMENTALSBASAL_id_ALTRES"           "CARDIOPATIAISQUEMICABASAL_id_ALTRES"      
# [27] "RETINOPATIADIABETICABASAL_id_ALTRES"       "DISFUNCIOSEXUALBASAL_id_ALTRES"           
# [29] "NEOPLASIESBASAL_id_ALTRES"                 "PEUDIABETICBASAL_id_ALTRES"               
# [31] "AMPUTACIONSBASAL_id_ALTRES"                "freqCardiaca"                             
# [33] "imc"                                       "perimetreCintura"                         
# [35] "pes"                                       "talla"                                    
# [37] "tensioDiastolica"                          "tensioSistolica"                          
# [39] "tensioBrac_id"                             "antiagregantsPlaquetaris_id"              
# [41] "anticoagulants_id"                         "antihipertensius_id"                      
# [43] "hipolemiants_id"                           "altreMedicacioGral_id"                    
# [45] "altreMedicacioGral_id_ALTRES"              "antiagregantsPlaquetaris_id_ALTRES"       
# [47] "anticoagulants_id_ALTRES"                  "antihipertensius_id_ALTRES"               
# #[49] "hipolemiants_id_ALTRES"                    "ANTIDEPRESSANTS_id_ALTRES"                
# [51] "ANTIPSYCHOTICS_id_ALTRES"                  "ANTIEPILEPTICS_id_ALTRES"                 
# [53] "ANXIOLYTICS_id_ALTRES"                     "OPIOIDS_id_ALTRES"                        
# [55] "CORTICOSTEROIDS_id_ALTRES"                 "OTHERANALGESICSANDANTIPYRETICS_id_ALTRES" 
# [57] "NSAID_ALTRES"                              "ADRENERGICS_INHALANTS_id_ALTRES"          
# [59] "THYROIDPREPARATIONS_id_ALTRES"             "HORMONES_id_ALTRES"                       
# [61] "adoAcarbosa_id"                            "adoCanagliflozina_id"                     
# [63] "adoClorpopramida_id"                       "adoCombiGlimepiridaPioglitazona_id"       
# [65] "adoCombiMetforminaPioglitazona_id"         "adoCombiMetforminaSaxaglitina_id"         
# [67] "adoCombiMetforminaSitagliptina_id"         "adoCombiMetforminaVildagliptina_id"       
# [69] "adoDapagliflozina_id"                      "adoEmpagliflozina_id"                     
# [71] "adoGlibenclamida_id"                       "adoGlibornurida_id"                       
# [73] "adoGliclazida_id"                          "adoGlimepirida_id"                        
# [75] "adoGlipizida_id"                           "adoGliquidona_id"                         
# [77] "adoLinagliptina_id"                        "adoMetformina_id"                         
# [79] "adoMiglitol_id"                            "adoNateglinida_id"                        
# [81] "adoPioglitazona_id"                        "adoRepaglinida_id"                        
# [83] "adoSaxagliptina_id"                        "adoSitagliptina_id"                       
# [85] "adoTolbutamida_id"                         "adoVildagliptina_id"                      
# [87] "altreMedicacioADO_id"                      "adoCombiMetforminaLinaglibtina_id_ALTRES" 
# [89] "adoCombiMetforminaAlogliptina_id_ALTRES"   "adoAlogliptina_id_ALTRES"                 
# [91] "adoCombiAlogliptinaPioglitazona_id_ALTRES" "adoCombMetforminaEmpaglifozina_id_ALTRES" 
# [93] "adoCombMetforminaDapaglifozina_id_ALTRES"  "injAbasaglar_id"                          
# [95] "injAbiglutida_id"                          "injActrapid_id"                           
# [97] "injApidra_id"                              "injExenatida_id"                          
# [99] "injHumalog_id"                             "injHumalogBasal_id"                       
#[101] "injHumalogMix25_id"                        "injHumalogMix50_id"                       
#[103] "injHumilana3070_id"                        "injHumulinaNPH_id"                        
#[105] "injHumulinaRegular_id"                     "injInsulatard_id"                         
#[107] "injLantus_id"                              "injLevemir_id"                            
#[109] "injLiraglutida_id"                         "injLixisenatide_id"                       
#[111] "injMixtard30_id"                           "injNovomix30_id"                          
#[113] "injNovomix50_id"                           "injNovomix70_id"                          
#[115] "injNovorapid_id"                           "altreMedicacioInjInsulina_id"             
#[117] "injToujeo_id_ALTRES"                       "injTresiba_id_ALTRES"                     
#[119] "injExenatida_id_ALTRES"                    "injAbasaglar_id_ALTRES"                   
#[121] "dataAnalitica"                             "glucosa"                                  
#[123] "hba1cIFCC"                                 "hba1cNGSP"                                
#[125] "alt"                                       "ast"                                      
#[127] "ggt"                                       "colesterolHdl"                            
#[129] "colesterolLdl"                             "colesterolNoHdl"                          
#[131] "colesterolTtl"                             "triglicerids"                             
#[133] "volumCorpuscularMig"                       "hematocrit"                               
#[135] "hemoglobina"                               "hemoglobinaCorpuscularMitja"              
#[137] "ide"                                       "hematies"                                 
#[139] "leucocits"                                 "plaquetes"                                
#[141] "linfocits"                                 "monocits"                                 
#[143] "neutrofils"                                "eosinofils"                               
#[145] "basofils"                                  "creatinina"                               
#[147] "filtratGlomerular"                         "filtratGlomerularSuperior60"              
#[149] "orinaCreatinina"                           "orinaMicroalbuminuria"                    
#[151] "orinaMicroalbuminuriaCreatinina"           "cigarretsDia"                             
#[153] "dataFiTabac"                               "dataIniciTabac"                           
#[155] "fumador_id"                                "motiuNoSeguiment"                         
#[157] "seguimentRecomenacions_id"                 "arteriopatiaPeriferica_id"                
#[159] "cardiopatiaIsquemica_id"                   "insuficienciaCardiaca_id"                 
#[161] "malaltiaCerebrovascular_id"                "nefropatiaDiabetica_id"                   
#[163] "neuropatiaDiabetica_id"                    "retinopatiaDiabetica_id"                  
#[165] "altresComplicacions_id"                    "PATOLOGIATIROIDAL_id_ALTRES"              
#[167] "MPOC_id_ALTRES"                            "MALALTIESMENTALS_id_ALTRES"               
#[169] "DISFUNCIOSEXUAL_id_ALTRES"                 "NEOPLASIES_id_ALTRES"                     
#[171] "PEUDIABETIC_id_ALTRES"                     "AMPUTACIONS_id_ALTRES"                    
#[173] "ingresCopsRelDiabetesNo"                   "ingresCopsRelDiabetesSi"                  
#[175] "urgenciesCopsRelDiabetesNo"                "urgenciesCopsRelDiabetesSi"               
#[177] "ingres_id"                                 "urgencies_id"                             
#[179] "consExterna_id"                            "consExternaCopsRelDiabetesNo"             
#[181] "consExternaCopsRelDiabetesSi"              "numTiresReact1Any"                        
#[183] "costDerivacions"                           "costIncapacitatsTemp"                     
#[185] "costLaboratori"                            "costMedicacio"                            
#[187] "costProfessionals"                         "costProvesCompl"                          
#[189] "costTiresReactives"                        "costVisites" 
#variable.names(LT_RESPOSTA_PAM)
#[1] "id"         "descripcio"


#i)     DT_COSTOSSANITARIS
#ii)    DT_PACIENT_lab_06.06.2020
#iii)   DT_QUESTIONARI_BPAAT
#iv)    DT_QUESTIONARI_DTSQ
#v)     DT_QUESTIONARI_EQ5D
#vi)    DT_QUESTIONARI_PAM
#vii)   DT_VISITA_HISTORIC_PLANA_lab_06.02.2020
#viii)  LT_RESPOSTA_PAM

DT_COSTOSSANITARIS<-DT_COSTOSSANITARIS%>%dplyr::select(-formComplet,-verificat)	   
DT_PACIENT_lab<-DT_PACIENT_lab 
DT_VISITA_HISTORIC_PLANA_lab<-DT_VISITA_HISTORIC_PLANA_lab  
DT_QUESTIONARI_BPAAT<-DT_QUESTIONARI_BPAAT%>%dplyr::select(-formComplet,-verificat)	   
DT_QUESTIONARI_DTSQ<-DT_QUESTIONARI_DTSQ%>%dplyr::select(-formComplet,-verificat)	   
DT_QUESTIONARI_EQ5D<-DT_QUESTIONARI_EQ5D%>%dplyr::select(-formComplet,-verificat)	   
DT_QUESTIONARI_PAM<-DT_QUESTIONARI_PAM%>%dplyr::select(-formComplet,-verificat)	   
#LT_RESPOSTA_PAM<-LT_RESPOSTA_PAM   
DT_VISITA<-DT_VISITA

#DT_DEMOGRAFIA<-DT_COSTOSSANITARIS%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_HISTORIAMEDICA<-DT_HISTORIAMEDICA%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_EXPLORACDT_COSTOSSANITARISIOFISICA<-DT_EXPLORACIOFISICA%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_MEDICACIO_GENERAL<-DT_MEDICACIO_GENERAL%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_MEDICACIO_ADO<-DT_MEDICACIO_ADO%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_MEDICACIO_INJECTABLES<-DT_MEDICACIO_INJECTABLES%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_ANALITICA<-DT_ANALITICA%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_HABITS_TOXICS<-DT_HABITS_TOXICS%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_SEGUIMENT<-DT_SEGUIMENT%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_COMPLICACIONS<-DT_COMPLICACIONS%>%dplyr::select(-formComplet,-verificat,-Id)	
#DT_COSTOSSANITARIS<-DT_COSTOSSANITARIS%>%dplyr::select(-formComplet,-verificat,-Id)	   















#DT_PACIENT<-rbind(DT_PACIENT_DISCONTINUADOS,DT_PACIENT_INCLUIDOS)
#DT_PACIENT_SELECT<-DT_PACIENT%>%dplyr::select(pacient_id)


# Aquests seran els pacients escollits:

#DT_PACIENT_SELECT


#i)   filtrema DT_VISITA_HISTORIC pesl pacients escollits.
#ii)  rectifiquem pacient_id=pacient_pacient_id  a la base de dades DT_VISITA


#---------------##---------------##---------------##---------------##---------------#
#DT_VISITA_HISTORIC<-DT_VISITA%>%mutate(pacient_id=pacient_pacient_id)%>%dplyr::select(tipus,pacient_id,visita_id,completa,dataVisita)


#De la base de dades dels Historics agafem nomes els PACIENT INCLU?TS [N=407!]
#FEM dues base de dades :[DT_VISITA_HISTORIC] i [DT_VISITA_HISTORIC_MES00]/mes00.

#DT_VISITA_HISTORIC<-DT_VISITA_HISTORIC%>%filter(pacient_id%in%DT_PACIENT_SELECT$pacient_id)
#---------------##---------------##---------------##---------------##---------------#


#0)     DT_PACIENT		
#ii)    DT_DEMOGRAFIA		
#iii)   DT_HISTORIAMEDICA		
#iv)    DT_EXPLORACIOFISICA		
#v)     DT_MEDICACIO_GENERAL		
#vi)    DT_MEDICACIO_ADO		
#vii)   DT_MEDICACIO_INJECTABLES		
#viii)  DT_ANALITICA		
#ix)    DT_HABITS_TOXICS		
#x)     DT_SEGUIMENT		
#xi)    DT_COMPLICACIONS	
#xii)   DT_COSTOSSANITARIS	            	
#---------------##---------------##---------------##---------------##---------------#  



#DT_DEMOGRAFIA<-DT_DEMOGRAFIA%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_HISTORIAMEDICA<-DT_HISTORIAMEDICA%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_EXPLORACIOFISICA<-DT_EXPLORACIOFISICA%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_MEDICACIO_GENERAL<-DT_MEDICACIO_GENERAL%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_MEDICACIO_ADO<-DT_MEDICACIO_ADO%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_MEDICACIO_INJECTABLES<-DT_MEDICACIO_INJECTABLES%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_ANALITICA<-DT_ANALITICA%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_HABITS_TOXICS<-DT_HABITS_TOXICS%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_SEGUIMENT<-DT_SEGUIMENT%>%dplyr::select(-formComplet,-verificat,-Id)		
#DT_COMPLICACIONS<-DT_COMPLICACIONS%>%dplyr::select(-formComplet,-verificat,-Id)	
#DT_COSTOSSANITARIS<-DT_COSTOSSANITARIS%>%dplyr::select(-formComplet,-verificat,-Id)	   







```



## 3. Fusió de dades
```{r fusio_taulaPlana}


#DT_PACIENT_lab
#DT_VISITA_HISTORIC_PLANA_lab

#DT_QUESTIONARI_BPAAT   
#DT_QUESTIONARI_DTSQ	   
#DT_QUESTIONARI_EQ5D 
#DT_QUESTIONARI_PAM	

#DT_COSTOSSANITARIS 
#
##LT_RESPOSTA_PAM




DT_VISITA_HISTORIC_PLANA_lab<-DT_VISITA_HISTORIC_PLANA_lab%>%select(-"...1")
DT_PACIENT_lab<-DT_PACIENT_lab%>%select(-"...1")
DT_QUESTIONARI_EQ5D<-DT_QUESTIONARI_EQ5D%>%select(-edat,-fumador_id,-sexe_id)


DT_VISITA_HISTORIC_FINAL<-DT_VISITA_HISTORIC_PLANA_lab%>%
  left_join(DT_VISITA   ,by="visita_id")%>%
   left_join(DT_PACIENT_lab   ,by="pacient_id")%>%
    left_join(DT_QUESTIONARI_BPAAT   ,by="visita_id")%>%
     left_join(DT_QUESTIONARI_DTSQ   ,by="visita_id")%>%
        left_join(DT_QUESTIONARI_EQ5D    ,by="visita_id")%>%
          left_join(DT_QUESTIONARI_PAM   ,by="visita_id")


variable.names(DT_VISITA_HISTORIC_FINAL)
  



#DT_VISITA_HISTORIC_FINAL<-DT_VISITA_HISTORIC%>%left_join(DT_PACIENT   ,by="pacient_id")%>%
#  left_join(DT_DEMOGRAFIA   ,by="visita_id")%>%
#    left_join(DT_HISTORIAMEDICA   ,by="visita_id")%>%
#      left_join(DT_EXPLORACIOFISICA   ,by="visita_id")%>%
#        left_join(DT_MEDICACIO_GENERAL   ,by="visita_id")%>%
#          left_join(DT_MEDICACIO_ADO   ,by="visita_id")%>%
#            left_join(DT_MEDICACIO_INJECTABLES   ,by="visita_id")%>%
#              left_join(DT_ANALITICA   ,by="visita_id")%>%
#                left_join(DT_HABITS_TOXICS   ,by="visita_id")%>%
#                 left_join(DT_SEGUIMENT   ,by="visita_id")%>%
#                  left_join(DT_COMPLICACIONS   ,by="visita_id")%>%
#                   left_join(DT_COSTOSSANITARIS   ,by="visita_id")
  



TAULA_PLANA<-DT_VISITA_HISTORIC_FINAL


#K<- as.vector(variable.names(TAULA_PLANA))
#write.csv(K, file="K.csv")




#kkk<- DT_VISITA_HISTORIC_FINAL%>%select(pacient_id,sexe_id,tipus,visita_id)%>%filter(tipus=="Mes00")

#	tipus
#	visita_id
#	completa
#	dataVisita
#	dataNaixement
#	edat
#	sexe_id
#	etnia_id
#	altresEtniaDescrip
#	problemesSalut_id
#	clinicalRiskGroup
#	duracioDiabetesAnys
#	duracioDiabetesMesos
#	duracioDiabetesMesos2
#	grupMorbiditatAjustada
#	dislipemia_id
#	dataDxDislipemia
#	hta_id
#	dataDxHta
#	altresProblemesSalut_id
#	altresProblemesSalutDescrip
#	PATOLOGIATIROIDALBASAL_id_ALTRES
#	MPOCBASAL_id_ALTRES
#	MALALTIESMENTALSBASAL_id_ALTRES
#	CARDIOPATIAISQUEMICABASAL_id_ALTRES
#	RETINOPATIADIABETICABASAL_id_ALTRES
#	DISFUNCIOSEXUALBASAL_id_ALTRES
#	NEOPLASIESBASAL_id_ALTRES
#	PEUDIABETICBASAL_id_ALTRES
#	AMPUTACIONSBASAL_id_ALTRES
#	freqCardiaca
#	imc
#	perimetreCintura
#	pes
#	talla
#	tensioDiastolica
#	tensioSistolica
#	tensioBrac_id
#	antiagregantsPlaquetaris_id
#	anticoagulants_id
#	antihipertensius_id
#	hipolemiants_id
#	altreMedicacioGral_id
#	altreMedicacioGral_id_ALTRES
#	antiagregantsPlaquetaris_id_ALTRES
#	anticoagulants_id_ALTRES
#	antihipertensius_id_ALTRES
#	hipolemiants_id_ALTRES
#	ANTIDEPRESSANTS_id_ALTRES
#	ANTIPSYCHOTICS_id_ALTRES
#	ANTIEPILEPTICS_id_ALTRES
#	ANXIOLYTICS_id_ALTRES
#	OPIOIDS_id_ALTRES
#	CORTICOSTEROIDS_id_ALTRES
#	OTHERANALGESICSANDANTIPYRETICS_id_ALTRES
#	NSAID_ALTRES
#	ADRENERGICS_INHALANTS_id_ALTRES
#	THYROIDPREPARATIONS_id_ALTRES
#	HORMONES_id_ALTRES
#	adoAcarbosa_id
#	adoCanagliflozina_id
#	adoClorpopramida_id
#	adoCombiGlimepiridaPioglitazona_id
#	adoCombiMetforminaPioglitazona_id
#	adoCombiMetforminaSaxaglitina_id
#	adoCombiMetforminaSitagliptina_id
#	adoCombiMetforminaVildagliptina_id
#	adoDapagliflozina_id
#	adoEmpagliflozina_id
#	adoGlibenclamida_id
#	adoGlibornurida_id
#	adoGliclazida_id
#	adoGlimepirida_id
#	adoGlipizida_id
#	adoGliquidona_id
#	adoLinagliptina_id
#	adoMetformina_id
#	adoMiglitol_id
#	adoNateglinida_id
#	adoPioglitazona_id
#	adoRepaglinida_id
#	adoSaxagliptina_id
#	adoSitagliptina_id
#	adoTolbutamida_id
#	adoVildagliptina_id
#	altreMedicacioADO_id
#	adoCombiMetforminaLinaglibtina_id_ALTRES
#	adoCombiMetforminaAlogliptina_id_ALTRES
#	adoAlogliptina_id_ALTRES
#	adoCombiAlogliptinaPioglitazona_id_ALTRES
#	adoCombMetforminaEmpaglifozina_id_ALTRES
#	adoCombMetforminaDapaglifozina_id_ALTRES
#	injAbasaglar_id
#	injAbiglutida_id
#	injActrapid_id
#	injApidra_id
#	injExenatida_id
#	injHumalog_id
#	injHumalogBasal_id
#	injHumalogMix_id
#	injHumalogMix_id
#	injHumilana_id
#	injHumulinaNPH_id
#	injHumulinaRegular_id
#	injInsulatard_id
#	injLantus_id
#	injLevemir_id
#	injLiraglutida_id
#	injLixisenatide_id
#	injMixtard_id
#	injNovomix_id
#	injNovomix_id
#	injNovomix_id
#	injNovorapid_id
#	altreMedicacioInjInsulina_id
#	injToujeo_id_ALTRES
#	injTresiba_id_ALTRES
#	injExenatida_id_ALTRES
#	injAbasaglar_id_ALTRES
#	dataAnalitica
#	glucosa
#	hbacIFCC
#	hbacNGSP
#	alt
#	ast
#	ggt
#	colesterolHdl
#	colesterolLdl
#	colesterolNoHdl
#	colesterolTtl
#	triglicerids
#	volumCorpuscularMig
#	hematocrit
#	hemoglobina
#	hemoglobinaCorpuscularMitja
#	ide
#	hematies
#	leucocits
#	plaquetes
#	linfocits
#	monocits
#	neutrofils
#	eosinofils
#	basofils
#	creatinina
#	filtratGlomerular
#	filtratGlomerularSuperior
#	orinaCreatinina
#	orinaMicroalbuminuria
#	orinaMicroalbuminuriaCreatinina
#	cigarretsDia
#	dataFiTabac
#	dataIniciTabac
#	fumador_id
#	motiuNoSeguiment
#	seguimentRecomenacions_id
#	arteriopatiaPeriferica_id
#	cardiopatiaIsquemica_id
#	insuficienciaCardiaca_id
#	malaltiaCerebrovascular_id
#	nefropatiaDiabetica_id
#	neuropatiaDiabetica_id
#	retinopatiaDiabetica_id
#	altresComplicacions_id
#	PATOLOGIATIROIDAL_id_ALTRES
#	MPOC_id_ALTRES
#	MALALTIESMENTALS_id_ALTRES
#	DISFUNCIOSEXUAL_id_ALTRES
#	NEOPLASIES_id_ALTRES
#	PEUDIABETIC_id_ALTRES
#	AMPUTACIONS_id_ALTRES
#	ingresCopsRelDiabetesNo
#	ingresCopsRelDiabetesSi
#	urgenciesCopsRelDiabetesNo
#	urgenciesCopsRelDiabetesSi
#	ingres_id
#	urgencies_id
#	consExterna_id
#	consExternaCopsRelDiabetesNo
#	consExternaCopsRelDiabetesSi
#	numTiresReactAny
#	costDerivacions
#	costIncapacitatsTemp
#	costLaboratori
#	costMedicacio
#	costProfessionals
#	costProvesCompl
#	costTiresReactives
#	costVisites
#	pacient_id
#	codiIdentificacioPacient
#	codiPacient
#	estat
#	grupIntervencio
#	usuari_id
#	centre_id
#	codiUBA
#	abrevCentre
#	codiCentre
#	nomCentre
#	pacients
#	GR
#	dataCreacio
#	dataConsentiment
#	motiuNoConsentiment
#	inclusioConsentiment_id
#	inclusioDxDM_id
#	inclusioEdat_id
#	inclusioHbacGrauminim_id
#	inclusioSenseCanvisTt_id
#	exclusioAltres_id
#	exclusioDroguesAlcohol_id
#	exclusioEmabarasLactancia_id
#	exclusioFarmacsMetabHidrocarb_id
#	exclusioHemoglobinapatiesAnemia_id
#	exclusioIMCSuperior_id
#	exclusioInsufCardiacaNYHA_id
#	exclusioMalaltiaMentalDemencia_id
#	exclusioMalaltiaTerminal_id
#	exclusioParticipacioAssaigClinicFarmacs_id
#	exclusioTransplRenalDialisis_id
#	exclusioTtFarmacsAprimar_id
#	exclusioTtGlucocorticoides_id
#	exclusioTtImmunosupresors_id
#	exclusioTtNeoplasiaMaligna_id
#	exclusioCanvisTt_id
#	exclusioHbacInferiorenmesos_id
#	exclusioControlEndocrinoleg_id
#	dataFiEstudi
#	finalitzaEstudi_id
#	motiuFinalEstudi_id
#	totalBPAAT
#	activitatIntensa_id
#	activitatModerada_id
#	pregFrequenciaSucreAlt
#	pregFrequenciaSucreBaix
#	pregRecomenacioTractament
#	pregSatisfConeixMalaltia
#	pregSatisfContTtActual
#	pregSatisfaccioTtActual
#	pregTractamentFlexible
#	pregTractamentPractic
#	totalDTSQ
#	activitatPrincipalDescrip
#	codiPostal
#	escalaAVSalut
#	treballSalutSocialDescrip
#	activitatPrincipal_id
#	estudisRealitzats_id
#	expMalGreuAltres_id
#	expMalGreuFamiliar_id
#	expMalGreuPersonal_id
#	pregAnsietat_id
#	pregCuraPersonal_id
#	pregDolor_id
#	pregMovilitat_id
#	pregQuotidianes_id
#	treballSalutSocial_id
#	totalPAM
#	pregAutoMedicacio_id
#	pregConeixMedicaments_id
#	pregConeixTtsDisponibles_id
#	pregEntenPSiCauses_id
#	pregEstilVidaEstres_id
#	pregEvitarPS_id
#	pregEvitarReduirPS_id
#	pregHabitsSaludables_id
#	pregInformarMetge_id
#	pregPaperActiu_id
#	pregResponsable_id
#	pregSeguiTtCasa_id
#	pregSolucioNousPS_id




```


## 4. Salvar taula plana 
```{r salvar}

saveRDS(TAULA_PLANA,     file=here::here(params$dir_dades_desti,"TAULA_PLANA.rds"))




```


